name: CI
on: push
jobs:
  node-minimum:
    name: Node.js
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ ubuntu-latest, macos-latest, windows-latest ]
        node-version: [ '17.x', '16.x', '15.x', '14.15.0' ]
    steps:
      - name: â• Actions - Checkout
        uses: actions/checkout@v2
      - name: â• Actions - Setup NodeJS
        uses: actions/setup-node@v2
        with:
          node-version: ${{ matrix.node-version }}
      - name: ğŸ“¥ Set Local FTP
        if: matrix.os == 'ubuntu-latest'
        run: docker run -d -p 21:21 -e FTP_USER=test -e FTP_PASS=test -e PASV_ADDRESS=127.0.0.1 bogem/ftp
      - name: ğŸ“¦ Upgrade to the minimum required NPM version
        if: matrix.node-version == '14.15.0'
        run: npm install -g npm@7.0.2
      - name: ğŸ“¦ Testing Services with FTP Connection
        run: npm run test-services
      - name: âª Checking Previous Step for Linux and macOS
        if: matrix.os == 'ubuntu-latest' || matrix.os == 'macos-latest'
        run: (ls "passed" && exit 0) || exit 1
      - name: âª Checking Previous Step for Windows
        if: matrix.os == 'windows-latest'
        run: ls "passed"; if ($?) { exit 0 } else { exit 1 }
  # publish:
  #   name: Publishing Package
  #   runs-on: ubuntu-latest
  #   needs: [ node-minimum, node-15, node-16, node-latest, macos-coverage, windows-coverage ]
  #   if: github.ref == 'refs/heads/main'
  #   steps:
  #     - name: â• Actions - Checkout
  #       uses: actions/checkout@v2
  #     - name: â• Actions - Setup NodeJS
  #       uses: actions/setup-node@v2
  #       with:
  #         node-version: '17'
  #         check-latest: true
  #         registry-url: 'https://npm.pkg.github.com'
  #         scope: '@wellwelwel'
  #     - name: ğŸ“¦ Preparing Package
  #       run: node .github/workflows/publish.js
  #     - name: ğŸ“¥ Publishing Package
  #       run: npm publish || exit 0
  #       env:
  #         NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}